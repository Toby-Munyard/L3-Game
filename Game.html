<!doctype html>

<head>
    <title>Star Jumper</title>
    <link rel="shortcut icon" href="images/StarSprite.png">
    <script src="player.js"></script>
    <script src="enemy.js"></script>
    <script src="platform.js"></script>
</head>

<body>
    <canvas id="gameCanvas" width="1000" height="600"></canvas>
    <script>
        var canvas;
        var canvasContext;

        window.onload = function () {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainloop, 1000 / 50);
        }

        //game variables
        var gameRun = true;
        var difficulty = 'easy';

        //player vars
        var pXpos = 0;
        var pYpos = 0;
        var pXSpeed = 5;
        var pYSpeed = 5;
        const P_SIZE = 20;
        var pSPRITE = new Image();
        pSPRITE.source = 'images/SpriteSheet.png';

        //enemy vars
        var eXpos = 0;
        var eYpos = 0;
        var eXSpeed = 5;
        var eYSpeed = 5;
        const E_SIZE = 20

        //movement vars
        var leftKeyPressed = false;
        var upKeyPressed = false;
        var rightKeyPressed = false;
        var downKeyPressed = false;
        var spaceKeyPressed = false;

        //movement constants
        const LEFT_KEY = 37;
        const UP_KEY = 38;
        const RIGHT_KEY = 39;
        const DOWN_KEY = 40;
        const SPACE_KEY = 32;

        //platfrom vars
        var PlatformXPos = 500;
        var PlatformYPos = 300;
        var PlatformXWidth = 100;
        var PlatformYHeight = 200;

        var player = new
        Player(pXpos, pYpos, P_SIZE, P_SIZE, 'green', pXSpeed, pYSpeed);
        var enemy = new
        Enemy(eXpos, eYpos, E_SIZE, E_SIZE, 'white', eXSpeed, eYSpeed);
        var platform = new
        Platform(PlatformXPos, PlatformYPos, PlatformXWidth, PlatformYHeight, 'brown');

        var userName = '';

        while (userName == '' || userName == null) {
            userName = prompt('what is your name?');
        };

        function mainloop() {
            if (gameRun) {
            colorRect(0, 0, canvas.width, canvas.height, 'black'); //background 
            colorRect(0, 520, canvas.width, 80, 'red'); //ground
            // colorRect(PlatformXPos, PlatformYPos, PlatformXWidth, PlatformYHeight, 'brown') //Platform
            // colorRect(eXpos, eYpos, E_SIZE, E_SIZE, 'white'); //enemy
            // colorRect(pXpos,pYpos,P_SIZE,P_SIZE,'white'); //player

            player.draw();
            player.move();
            player.collide();
            enemy.draw();
            enemy.EnemyMove();
            // enemy.isCollide();
            platform.draw();
            colorText(userName + "'s score is ", 15, 20, '20px Arial', 'Lime')
            colorText(userName + "'s health is ", 15, 40, '20px Arial', 'Lime')
            colorText('Arrow Keys to move! Dodge Those Enemies!', 15, 60, '20px Arial', 'Lime')
            } else {
                colorText('Game Over!', 50, 50, '20px Arial', 'red');
            };
        };

        // function collison() {
        // if (eYpos + E_SIZE > pYpos && eYpos < pYpos + P_SIZE && eXpos + E_SIZE > pXpos && eXpos < pXpos + P_SIZE) {
        //             // player respawns to center of canvas after enemy collides with player
        //             eXpos = Math.floor(Math.random() * (canvas.width - enemy.ESIZE));
        //             eYpos = canvas.height + 100;
        //             pXpos = canvas.width / 2;
        //             pYpos = canvas.height - P_SIZE * 1.75;
        //             console.log('collide');
        //         }
        //     }

            function collison() {
        if (eYpos + E_SIZE > pYpos) {
                    // player respawns to center of canvas after enemy collides with player
                    eXpos = Math.floor(Math.random() * (canvas.width - enemy.E_SIZE));
                    eYpos = canvas.height + 100;
                    pXpos = canvas.width / 2;
                    pYpos = canvas.height - P_SIZE * 1.75;
                    console.log('collide');
                }
            }

        function keyPressed(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = true;
            }
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = true;
            }
        }

        function keyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = false;
            }
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = false;
            }
        }

        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        } //end func defines the basic outline of the screen
        function colorText(msg, x, y, f, c) {
            canvasContext.fillStyle = c;
            canvasContext.font = f;
            canvasContext.fillText(msg, x, y);
        }
    </script>
</body>